<mat-card class="order-form">
  <mat-card-header>
    <mat-card-title>
      <h2>Create New Order</h2>
    </mat-card-title>
  </mat-card-header>

  <mat-card-content>
    <form [formGroup]="form" (ngSubmit)="submit()">

      <!-- Número de Mesa -->
      <div class="form-group">
        <mat-form-field appearance="fill" class="w-100">
          <mat-label>Table Number</mat-label>
          <input matInput type="number" formControlName="tableNumber" placeholder="Ej: 5" />
          <mat-error *ngIf="form.get('tableNumber')?.hasError('required')">
            Table number is required.
          </mat-error>
          <mat-error *ngIf="form.get('tableNumber')?.hasError('min')">
            Table number must be at least 1.
          </mat-error>
        </mat-form-field>
      </div>

      <!-- Lista de platos -->
      <div formArrayName="items">
        <div *ngFor="let item of items.controls; let i = index" [formGroupName]="i" class="item-row">

          <!-- Plato -->
          <mat-form-field appearance="fill" class="w-100">
            <mat-label>Dish</mat-label>
            <mat-select formControlName="dishId">
              <mat-option [value]="null" disabled>Select a dish</mat-option>
              <mat-option *ngFor="let dish of dishes" [value]="dish.id">
                {{ dish.name }} (S/ {{ dish.price }})
              </mat-option>
            </mat-select>
            <mat-error *ngIf="item.get('dishId')?.hasError('required')">
              A dish must be select.
            </mat-error>
          </mat-form-field>

          <!-- Cantidad -->
          <mat-form-field appearance="fill" class="w-100">
            <mat-label>Quantity</mat-label>
            <input matInput type="number" formControlName="quantity" min="1" />
            <mat-error *ngIf="item.get('quantity')?.hasError('required')">
              Quantity is required.
            </mat-error>
            <mat-error *ngIf="item.get('quantity')?.hasError('min')">
              Minimum 1.
            </mat-error>
          </mat-form-field>

          <!-- Eliminar -->
          <button mat-raised-button color="warn" type="button" class="remove-btn" (click)="removeDish(i)" *ngIf="items.length > 1">
            Remove
          </button>

        </div>
      </div>

      <!-- Botón agregar plato -->
      <button mat-raised-button type="button" class="add-btn" (click)="addDish()">
        + Add a dish
      </button>

      <!-- Total -->
      <div class="form-group">
        <strong>Estimated Total: S/ {{ calculateTotal() | number:'1.2-2' }}</strong>
      </div>

      <!-- Botón guardar -->
      <button mat-raised-button type="submit" class="submit-btn" [disabled]="form.invalid || items.length === 0">
        Save Order
      </button>

    </form>
  </mat-card-content>
</mat-card>
